<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- PWA iOS å°ˆå±¬æ¨™ç±¤ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="æ±äº¬ç¨æ—…">
    <link rel="apple-touch-icon" href="app-icon.png">
    <title>2026æ±äº¬ç¨æ—…è‡ªç”±è¡Œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Varela+Round&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- åŠ å…¥ Leaflet äº’å‹•å¼åœ°åœ–åº« CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <style>
        :root {
            --bg-color: #F7F4EB;
            --glass-bg: rgba(255, 255, 255, 0.65);
            --glass-border: rgba(255, 255, 255, 0.8);
            --soft-shadow: 4px 4px 16px #E0E5D5, -4px -4px 16px #FFFFFF;
            --text-main: #4A4A4A;
            --text-sub: #8E8E93;
            --tag-transport: #4285F4; 
            --tag-attraction: #34A853; 
            --tag-food: #F9AB00; 
            --tag-alert: #FF8A65;
            --accent-color: #A3C7B6;
            --tip-bg: rgba(255, 176, 103, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Varela Round', 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; scroll-behavior: smooth;}
        
        body {
            background-color: var(--bg-color);
            background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" stitchTiles="stitch"/></filter><rect width="100" height="100" filter="url(%23noise)" opacity="0.05"/></svg>');
            color: var(--text-main); display: flex; justify-content: center;
        }

        #app { width: 100%; max-width: 430px; height: 100dvh; position: relative; display: flex; flex-direction: column; overflow: hidden;}
        .glass { background: var(--glass-bg); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--glass-border); border-radius: 24px; box-shadow: var(--soft-shadow); }

        /* --- Header --- */
        header { padding: 15px 20px 5px; z-index: 10; transition: 0.3s; }
        .header-title-wrapper { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .app-logo { width: 36px; height: 36px; border-radius: 22%; object-fit: cover; box-shadow: 2px 2px 8px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.8); }
        .header-title { font-size: 22px; font-weight: 700; letter-spacing: 1px; margin: 0;}
        
        .weather-card {
            display: block; padding: 8px 15px; font-size: 13px; font-weight: 700; text-decoration: none; color: var(--text-main); 
            transition: transform 0.2s; margin-bottom: 5px; border-radius: 16px; position: relative; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.4); box-shadow: 2px 2px 10px rgba(0,0,0,0.03);
        }
        .weather-card::before {
            content: ''; position: absolute; inset: 0; z-index: -1;
            background: rgba(247, 244, 235, 0.3); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            filter: url(#liquid-filter); pointer-events: none;
        }
        .weather-card:active { transform: scale(0.98); }
        .weather-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2px; }
        .weather-desc { font-size: 11px; color: var(--text-sub); font-weight: 500;}

        /* --- å…§å®¹å€ --- */
        .content-area { flex: 1; overflow-y: auto; padding: 0 20px 110px; scrollbar-width: none; }
        .content-area::-webkit-scrollbar { display: none; }
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- iOS 26 Liquid Glass å‡çµåˆ— --- */
        .sticky-header { position: sticky; top: 0; z-index: 50; margin: 0 -20px 10px -20px; padding: 10px 20px; }
        .liquid-bg::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(247, 244, 235, 0.4); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            filter: url(#liquid-filter); mask-image: linear-gradient(to bottom, black 70%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 70%, transparent 100%); z-index: -1; pointer-events: none;
        }

        /* --- 1. è¡Œç¨‹ Tab --- */
        .date-picker { display: flex; gap: 10px; overflow-x: auto; scrollbar-width: none; padding-bottom: 5px; }
        .date-picker::-webkit-scrollbar { display: none; }
        .date-chip { min-width: 75px; padding: 10px 5px; text-align: center; cursor: pointer; border-radius: 20px; font-size: 13px; font-weight: 700; color: var(--text-sub); transition: 0.3s; box-shadow: 2px 2px 8px rgba(0,0,0,0.05); background: rgba(255,255,255,0.8); border: 1px solid rgba(255,255,255,0.9);}
        .date-chip.active { background: var(--accent-color); color: white; transform: scale(1.05); border:none;}

        .timeline { position: relative; padding-left: 20px; margin-top: 5px; }
        .timeline::before { content: ''; position: absolute; left: 6px; top: 0; bottom: 0; width: 2px; background: rgba(0,0,0,0.05); }
        .timeline-item { position: relative; margin-bottom: 24px; }
        .timeline-dot { position: absolute; left: -21px; top: 5px; width: 14px; height: 14px; border-radius: 50%; border: 3px solid var(--bg-color); z-index: 2; }
        .timeline-card { padding: 16px; }
        .time-text { font-size: 12px; color: var(--text-sub); margin-bottom: 4px; font-weight: 700;}
        .title-text { font-size: 16px; font-weight: 700; margin-bottom: 8px; line-height: 1.4;}
        .desc-text { font-size: 13px; color: var(--text-main); margin-bottom: 12px; line-height: 1.5;}
        
        .nav-btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 14px; background: rgba(255,255,255,0.9); border-radius: 16px; font-size: 12px; color: var(--text-main); text-decoration: none; font-weight: 700; box-shadow: 2px 2px 8px rgba(0,0,0,0.03); transition: 0.2s; margin-right: 5px; margin-top: 5px;}
        .nav-btn:active { transform: scale(0.95); }
        .nav-btn.external { background: #FFF3E0; color: #E65100; }
        .nav-btn.photo { background: #E3F2FD; color: #1565C0; }
        
        .tip-box { margin-top: 12px; padding: 10px 12px; background: var(--tip-bg); border-left: 3px solid #FFA000; border-radius: 8px; font-size: 12px; color: #555; display: flex; gap: 8px; align-items: flex-start; line-height: 1.5; }
        .menu-tip { background: rgba(249, 171, 0, 0.1); border-left: 3px solid var(--tag-food); padding: 8px; border-radius: 6px; margin-top: 6px; font-size: 12px; }
        
        details.sub-spots { margin-top: 12px; background: rgba(255,255,255,0.6); border-radius: 12px; overflow: hidden; }
        details.sub-spots summary { padding: 10px 15px; font-size: 13px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: space-between; list-style: none; }
        details.sub-spots summary::-webkit-details-marker { display: none; }
        details.sub-spots summary::after { content: '\f078'; font-family: 'FontAwesome'; font-size: 10px; transition: 0.3s; color: var(--text-sub); }
        details.sub-spots[open] summary::after { transform: rotate(180deg); color: var(--accent-color); }
        .sub-spot-item { padding: 12px 15px; border-top: 1px dashed rgba(0,0,0,0.08); font-size: 13px; }
        .sub-spot-title { font-weight: 700; color: var(--text-main); margin-bottom: 4px; display: flex; align-items: center; gap: 6px;}

        .back-to-top-btn { display: flex; align-items: center; justify-content: center; gap: 6px; margin: 0 auto 20px; padding: 10px 20px; width: fit-content; background: rgba(255,255,255,0.7); backdrop-filter: blur(10px); border-radius: 20px; border: 1px solid var(--glass-border); font-size: 13px; font-weight: 700; color: var(--text-main); box-shadow: 2px 2px 10px rgba(0,0,0,0.05); cursor: pointer; transition: 0.2s; }
        .back-to-top-btn:active { transform: scale(0.95); }

        .highlight-ticket { color: #e91e63; font-weight: 700; background: rgba(233, 30, 99, 0.1); padding: 4px 8px; border-radius: 6px; cursor: pointer; display: inline-block; transition: 0.2s; box-shadow: 1px 1px 4px rgba(233, 30, 99, 0.2);}
        .highlight-ticket:active { transform: scale(0.95); opacity: 0.8; }
        .highlight-reserve { color: #d32f2f; font-weight: 700; background: rgba(211, 47, 47, 0.1); padding: 4px 8px; border-radius: 6px; display: inline-block; cursor: pointer; transition: 0.2s; box-shadow: 1px 1px 4px rgba(211, 47, 47, 0.2);}
        .highlight-reserve:active { transform: scale(0.95); opacity: 0.8; }

        .cat-transport .timeline-dot { background: #8AB4F8; }
        .cat-attraction .timeline-dot { background: #81C995; }
        .cat-food .timeline-dot { background: #FFB067; }

        /* --- 2. é è¨‚ Tab --- */
        details.glass-accordion { margin-bottom: 15px; border-radius: 24px; overflow: hidden; }
        summary.accordion-header { padding: 18px 20px; font-weight: 700; font-size: 16px; cursor: pointer; list-style: none; display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.4); }
        summary.accordion-header::-webkit-details-marker { display: none; }
        summary.accordion-header::after { content: '\f078'; font-family: 'FontAwesome'; font-weight: 900; color: var(--text-sub); transition: 0.3s; }
        details.glass-accordion[open] summary.accordion-header::after { transform: rotate(180deg); color: var(--accent-color); }
        .accordion-content { padding: 20px; border-top: 1px solid rgba(255,255,255,0.5); }
        .bp-divider { border-top: 2px dashed rgba(0,0,0,0.1); margin: 15px 0; }
        .bp-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .bp-label { font-size: 11px; color: var(--text-sub); }
        .bp-val { font-size: 15px; font-weight: 700; }
        .ticket-item { display: flex; align-items: center; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .ticket-item:last-child { border-bottom: none; }
        .ticket-icon { width: 40px; height: 40px; background: white; border-radius: 12px; display: flex; justify-content: center; align-items: center; font-size: 18px; box-shadow: 2px 2px 8px rgba(0,0,0,0.05); margin-right: 12px; flex-shrink: 0;}
        .link-btn { background: var(--accent-color); color: white; padding: 6px 12px; border-radius: 12px; font-size: 12px; text-decoration: none; font-weight: 700; white-space: nowrap;}
        .qr-img { width: 65px; height: 65px; border-radius: 8px; border: 2px solid white; box-shadow: 2px 2px 8px rgba(0,0,0,0.1); object-fit: cover;}

        /* --- 3 & 5. è¨˜å¸³èˆ‡æº–å‚™å…±ç”¨ï¼šæ»‘å‹•åˆªé™¤ UI --- */
        .expense-dash { text-align: center; padding: 15px; }
        .total-twd { font-size: 32px; font-weight: 700; color: var(--accent-color); margin-bottom: 4px; }
        .total-jpy { font-size: 14px; color: var(--text-sub); }
        .expense-form { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; margin-top: 10px;}
        .input-glass { border: none; background: rgba(255,255,255,0.8); padding: 12px; border-radius: 16px; font-size: 15px; outline: none; box-shadow: inset 2px 2px 6px rgba(0,0,0,0.03); color: var(--text-main); font-weight: 500; appearance: none; width: 100%;}
        .btn-add { grid-column: span 2; background: var(--accent-color); color: white; border: none; padding: 14px; border-radius: 16px; font-weight: 700; font-size: 16px; cursor: pointer; transition: 0.2s;}
        .daily-expense-group { margin-bottom: 20px; }
        .daily-expense-title { font-size: 14px; font-weight: 700; color: var(--text-sub); margin-bottom: 10px; padding-left: 5px; display: flex; justify-content: space-between;}
        
        .swipe-wrapper { overflow: hidden; border-radius: 16px; margin-bottom: 8px; position: relative; background: var(--glass-bg); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid var(--glass-border); box-shadow: var(--soft-shadow); }
        .swipe-track { display: flex; flex-wrap: nowrap; width: 100%; transform: translateX(0); transition: transform 0.25s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .swipe-content { flex: 0 0 100%; width: 100%; display: flex; justify-content: space-between; padding: 16px; align-items: center; box-sizing: border-box; background: transparent; }
        .swipe-actions { flex: 0 0 140px; display: flex; }
        .swipe-btn { border: none; flex: 1; color: white; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; outline: none; transition: 0.2s;}
        .swipe-btn:active { filter: brightness(0.8); }
        .swipe-btn.edit { background: #FFB067; }
        .swipe-btn.delete { background: #E53935; }

        /* --- 4. åœ°åœ– Tab --- */
        #map-container-wrapper { position: relative; width: 100%; height: calc(100dvh - 300px); border-radius: 24px; overflow: hidden; box-shadow: var(--soft-shadow); border: 1px solid var(--glass-border); z-index: 1;}
        #interactive-map { width: 100%; height: 100%; background: #e5e5e5;}
        .map-legend { position: absolute; top: 10px; left: 10px; z-index: 1000; padding: 12px; font-size: 12px; font-weight: 700; line-height: 1.8; border-radius: 16px; background: rgba(255,255,255,0.85); backdrop-filter: blur(10px); box-shadow: 2px 2px 10px rgba(0,0,0,0.1); }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .legend-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; }
        .leaflet-pane { z-index: 1 !important; }
        .leaflet-control-container { z-index: 10 !important; }

        /* --- 5. æº–å‚™ Tab å‹•æ…‹ UI --- */
        .plan-group { margin-bottom: 24px; }
        .plan-group-title { font-size: 15px; margin-bottom: 12px; color: var(--text-sub); padding-left: 5px; font-weight: 700;}
        .plan-box { width: 22px; height: 22px; border: 2px solid var(--accent-color); border-radius: 8px; display: flex; align-items: center; justify-content: center; transition: 0.2s; margin-right: 12px; flex-shrink: 0;}
        .plan-item-done .plan-box { background: var(--accent-color); }
        .plan-item-done .plan-box::after { content: 'âœ“'; color: white; font-size: 14px; }
        .plan-item-done .plan-text { text-decoration: line-through; color: var(--text-sub); }
        .add-plan-row { display: flex; gap: 8px; margin-top: 10px; align-items: center;}
        .add-plan-input { flex: 1; border: 1px solid rgba(255,255,255,0.8); background: rgba(255,255,255,0.7); padding: 12px 16px; border-radius: 16px; font-size: 14px; outline: none; box-shadow: inset 2px 2px 6px rgba(0,0,0,0.03); color: var(--text-main); font-weight: 500;}
        .add-plan-btn { width: 42px; height: 42px; border-radius: 14px; background: var(--accent-color); color: white; border: none; font-size: 16px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 10px rgba(163, 199, 182, 0.4); flex-shrink: 0;}
        .add-plan-btn:active { transform: scale(0.9); }

        /* --- æµ®å‹•åœ“è§’å°è¦½åˆ— --- */
        nav { 
            position: absolute; bottom: 20px; left: 20px; right: 20px; 
            height: 70px; padding: 0 15px; border-radius: 40px; 
            display: flex; justify-content: space-between; align-items: center; z-index: 100; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.08); 
        }
        nav::before { 
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; 
            background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px); 
            filter: url(#liquid-filter); border-radius: 40px; border: 1px solid rgba(255,255,255,0.9); z-index: -1; 
        }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--text-sub); cursor: pointer; transition: 0.3s; width: 50px; }
        .nav-item i { font-size: 20px; transition: transform 0.3s; }
        .nav-item span { font-size: 10px; font-weight: 700; }
        .nav-item.active { color: var(--accent-color); }
        .nav-item.active i { transform: translateY(-4px) scale(1.2); }
    </style>
</head>

<body>

<!-- SVG Liquid Glass æ¿¾é¡ -->
<svg style="width:0;height:0;position:absolute;">
    <filter id="liquid-filter">
        <feTurbulence type="fractalNoise" baseFrequency="0.015" numOctaves="3" result="noise" />
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="3" xChannelSelector="R" yChannelSelector="G" />
    </filter>
</svg>

<div id="app">
    <!-- Header -->
    <header id="main-header">
        <div class="header-title-wrapper">
            <img src="app-icon.png" alt="Logo" class="app-logo" onerror="this.style.display='none'">
            <div class="header-title">2026æ±äº¬ç¨æ—…</div>
        </div>
        <a href="https://tenki.jp/forecast/3/16/4410/13101/" target="_blank" class="weather-card" id="weather-display">
            <div class="weather-top">
                <span>ğŸ“ æ±äº¬å³æ™‚å¤©æ°£ (é»æ“Šçœ‹è©³æƒ…)</span>
                <span><i class="fa-solid fa-spinner fa-spin"></i></span>
            </div>
            <div class="weather-desc">é€£ç·šä¸­ï¼Œè«‹ç¨å€™...</div>
        </a>
    </header>

    <div class="content-area" id="main-content">
        
        <!-- 1. è¡Œç¨‹ Tab -->
        <div id="tab-schedule" class="tab-content active">
            <div class="sticky-header liquid-bg">
                <div class="date-picker" id="date-picker-schedule"></div>
            </div>
            <div id="day-title" style="margin: 5px 5px 15px; font-weight: 700; font-size: 18px;"></div>
            <div class="timeline" id="timeline-container"></div>
        </div>

        <!-- 2. é è¨‚ Tab -->
        <div id="tab-bookings" class="tab-content">
            <details class="glass glass-accordion" open>
                <summary class="accordion-header"><i class="fa-solid fa-plane-departure"></i> èˆªç­è³‡è¨Š</summary>
                <div class="accordion-content">
                    <div class="bp-row"><div><div class="bp-label">å»ç¨‹ (è™èˆª)</div><div class="bp-val">3/12 06:15</div></div><div class="bp-val" style="color:var(--accent-color);">IT200</div></div>
                    <div class="bp-row" style="font-size:12px;"><span>TPE (æ¡ƒåœ’ T1)</span><i class="fa-solid fa-arrow-right"></i><span>NRT (æˆç”°)</span></div><div class="bp-label">åº§ä½: 25A</div>
                    <!-- æ©Ÿå ´æ¥é€æé†’ -->
                    <div style="margin-top: 8px; text-align: left;">
                        <span style="font-size: 11px; color: #E53935; font-weight: 700;"><i class="fa-solid fa-car"></i> ã€å·²é ç´„æ©Ÿå ´æ¥é€ã€‘03:30 å‡ºç™¼</span>
                    </div>
                    <div class="bp-divider"></div>
                    <div class="bp-row"><div><div class="bp-label">å›ç¨‹ (æ˜Ÿå®‡)</div><div class="bp-val">3/17 15:40</div></div><div class="bp-val" style="color:var(--accent-color);">JX803</div></div>
                    <div class="bp-row" style="font-size:12px;"><span>NRT (æˆç”° T2)</span><i class="fa-solid fa-arrow-right"></i><span>TPE (æ¡ƒåœ’)</span></div><div class="bp-label">åº§ä½: 33K</div>
                </div>
            </details>
            <details class="glass glass-accordion" open>
                <summary class="accordion-header"><i class="fa-solid fa-ticket"></i> é–€ç¥¨ / æ†‘è­‰</summary>
                <div class="accordion-content">
                    <div class="ticket-item" style="align-items:flex-start;">
                        <div style="display:flex;gap:12px;">
                            <div class="ticket-icon" style="color:#2b82c9;"><i class="fa-solid fa-tower-broadcast"></i></div>
                            <div>
                                <div style="font-weight:700;font-size:14px;">æ±äº¬æ™´ç©ºå¡”</div>
                                <div class="bp-label">3/12 17:00 å…¥å ´<br>é»åœ–é–‹æ†‘è­‰ â¡ï¸</div>
                            </div>
                        </div>
                        <a href="https://drive.google.com/file/d/1tIjH1z_qraS3Jtdz0o4o_uH4H6PDmjb5/view?usp=drive_link" target="_blank">
                            <img src="https://lh3.googleusercontent.com/d/1anMF1YFB2KYnvr0h5Bw5StxwSyV6YxI0" alt="æ™´ç©ºå¡”QR" class="qr-img">
                        </a>
                    </div>
                    <div class="ticket-item">
                        <div style="display:flex;gap:12px;align-items:center;">
                            <div class="ticket-icon" style="color:#e91e63;">ğŸ¨</div>
                            <div><div style="font-weight:700;font-size:14px;">éº»å¸ƒå° teamLab</div><div class="bp-label">3/16 09:00 å…¥å ´</div></div>
                        </div>
                        <a href="https://borderless-azabudai.ticket.teamlab.art/tickets/#/id/tTPJJrgbLnrshz6m4c1xxp8RQuK6vfIXiGCYbJa6cROxMFPpPzKjHqFRY_YQpSwG?lang=zh-hant" target="_blank" class="link-btn">é–‹å•Ÿç¥¨åˆ¸</a>
                    </div>
                </div>
            </details>
            <details class="glass glass-accordion" open>
                <summary class="accordion-header"><i class="fa-solid fa-utensils"></i> é¤å»³é è¨‚</summary>
                <div class="accordion-content">
                    <div class="ticket-item">
                        <div style="display:flex;gap:12px;align-items:center;"><div class="ticket-icon">ğŸ¥©</div><div><div style="font-weight:700;font-size:14px;">Ushigoro éŠ€åº§</div><div class="bp-label">3/15 12:00</div></div></div>
                        <a href="https://r.tablecheck.co/CL0/https:%2F%2Fwww.tablecheck.com%2Fja%2Freservations%2F5GUDSY/1/0100019c54fe764b-b2b29c69-4fd4-42d6-8c66-d0c9ef57e3a1-000000/Psw45Hx90vuFmpJmLQgIymwZXrDmSapaFguY1HQMl9M=444" target="_blank" class="link-btn" style="background:#d32f2f;">æŸ¥çœ‹è¨‚ä½</a>
                    </div>
                    <div class="ticket-item">
                        <div style="display:flex;gap:12px;align-items:center;"><div class="ticket-icon">ğŸ²</div><div><div style="font-weight:700;font-size:14px;">ä»ŠåŠ ä¸Šé‡å»£å°è·¯</div><div class="bp-label">3/17 11:30</div></div></div>
                        <a href="https://r.tablecheck.co/CL0/https:%2F%2Fwww.tablecheck.com%2Fja%2Freservations%2FKQHM59/1/0100019c07cc8607-b058db8b-1757-47ff-8f17-284d79e685c1-000000/pLCZrneoqlqrgvJUqcvUeZ0YYIu2LIH_6uoqfXmzrbk=442" target="_blank" class="link-btn" style="background:#d32f2f;">æŸ¥çœ‹è¨‚ä½</a>
                    </div>
                </div>
            </details>
        </div>

        <!-- 3. è¨˜å¸³ Tab -->
        <div id="tab-expense" class="tab-content">
            <div class="sticky-header liquid-bg" style="padding: 10px; margin-bottom: 5px;">
                <div class="expense-dash glass" style="margin-bottom:0;">
                    <div class="total-twd" id="total-twd">NT$ 0</div>
                    <div class="total-jpy" id="total-jpy">Â¥ 0 (åŒ¯ç‡ 0.21)</div>
                </div>
            </div>
            
            <div class="expense-form">
                <input type="date" id="exp-date" class="input-glass" value="2026-03-12">
                <select id="exp-category" class="input-glass">
                    <option value="é£²é£Ÿ">ğŸ½ï¸ é£²é£Ÿ</option><option value="è³¼ç‰©">ğŸ›ï¸ è³¼ç‰©</option><option value="é–€ç¥¨">ğŸŸï¸ é–€ç¥¨</option>
                    <option value="ç´€å¿µå“">ğŸ ç´€å¿µå“</option><option value="äº¤é€š">ğŸš† äº¤é€š</option><option value="å…¶ä»–">ğŸ“Œ å…¶ä»–</option>
                </select>
                <input type="number" id="exp-amount" class="input-glass" style="grid-column: span 2;" placeholder="è¼¸å…¥æ—¥å¹£é‡‘é¡ (Â¥)" pattern="\d*">
                <input type="hidden" id="edit-id" value="">
                <button class="btn-add" id="btn-save-exp" onclick="saveExpense()"><i class="fa-solid fa-check"></i> ç¢ºèªæ–°å¢</button>
            </div>
            <div id="expense-list-container"></div>
        </div>

        <!-- 4. åœ°åœ– Tab -->
        <div id="tab-map" class="tab-content">
            <div class="sticky-header liquid-bg">
                <div class="date-picker" id="date-picker-map"></div>
            </div>
            <div id="map-container-wrapper">
                <div id="interactive-map"></div>
                <div class="map-legend">
                    <div class="legend-item"><span class="legend-dot" style="background: var(--tag-transport);"></span> äº¤é€š / ä½å®¿</div>
                    <div class="legend-item"><span class="legend-dot" style="background: var(--tag-attraction);"></span> è§€å…‰æ™¯é»</div>
                    <div class="legend-item"><span class="legend-dot" style="background: var(--tag-food);"></span> ç¾é£Ÿ / è³¼ç‰©</div>
                </div>
            </div>
        </div>

        <!-- 5. æº–å‚™ Tab -->
        <div id="tab-planning" class="tab-content">
            <div id="planning-list-container"></div>
        </div>
    </div>

    <!-- Bottom Nav -->
    <nav>
        <div class="nav-item active" id="nav-schedule" onclick="switchTab('schedule', this)"><i class="fa-regular fa-calendar-check"></i><span>è¡Œç¨‹</span></div>
        <div class="nav-item" id="nav-bookings" onclick="switchTab('bookings', this)"><i class="fa-solid fa-ticket"></i><span>é è¨‚</span></div>
        <div class="nav-item" id="nav-expense" onclick="switchTab('expense', this)"><i class="fa-solid fa-yen-sign"></i><span>è¨˜å¸³</span></div>
        <div class="nav-item" id="nav-map" onclick="switchTab('map', this)"><i class="fa-solid fa-map-location-dot"></i><span>åœ°åœ–</span></div>
        <div class="nav-item" id="nav-planning" onclick="switchTab('planning', this)"><i class="fa-solid fa-suitcase-rolling"></i><span>æº–å‚™</span></div>
    </nav>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // --- 0. è³‡æ–™æŒä¹…åŒ– (Local Storage) ---
    let expenses =[];
    const exchangeRate = 0.21;
    
    // é è¨­æº–å‚™æ¸…å–® (å‹•æ…‹æ“´å……èˆ‡åˆªé™¤)
    const defaultPlans =[
        { cat: "ğŸ§´ ç”Ÿæ´»ç”¨å“", items:[
            { id: "p1", text: "è­·ç…§ & å¯¦é«”æ—¥å¹£", done: false }, { id: "p2", text: "è­‰ä»¶ã€ä¿¡ç”¨å¡", done: false }, 
            { id: "p3", text: "å£ç½©", done: false }, { id: "p4", text: "ä¹³æ¶²ã€åŒ–å¦æ°´ (åŒ–å¦åŒ…)", done: false },
            { id: "p5", text: "åˆ®é¬åˆ€", done: false }, { id: "p6", text: "è¼•ä¾¿æ‹–é‹", done: false },
            { id: "p7", text: "é¦™æ°´", done: false }, { id: "p8", text: "æ‘ºç–Šå‚˜", done: false }, { id: "p9", text: "è¡›ç”Ÿç´™ / æ¿•ç´™å·¾", done: false }
        ]},
        { cat: "ğŸ“± 3C ç”¢å“", items:[
            { id: "p10", text: "æ‰‹æ©Ÿ", done: false }, { id: "p11", text: "è¡Œå‹•é›»æº (å¿…å¸¶)", done: false },
            { id: "p12", text: "å……é›»ç·š & è½‰æ¥é ­", done: false }, { id: "p13", text: "ç›¸æ©Ÿ", done: false }, { id: "p14", text: "é™å™ªè€³æ©Ÿ", done: false }
        ]},
        { cat: "ğŸ‘• è¡£ç‰©", items:[
            { id: "p15", text: "è¡£æœ (æ›æ´—)", done: false }, { id: "p16", text: "è¤²å­", done: false },
            { id: "p17", text: "ä¿æš–å¤–å¥— (æ´‹è”¥å¼ç©¿æ­)", done: false }, { id: "p18", text: "å¸½å­ / é…ä»¶", done: false }
        ]},
        { cat: "ğŸ§³ é›œé …", items:[
            { id: "p19", text: "å¸¸å‚™è—¥ / å°è­·å£« / é˜²èšŠæ¶²", done: false }, { id: "p20", text: "å£“ç¸®è¢‹", done: false },
            { id: "p21", text: "å¤¾éˆè¢‹", done: false }, { id: "p22", text: "è³¼ç‰©è¢‹", done: false }
        ]}
    ];
    let plans =[];

    function loadData() { 
        const e = localStorage.getItem('tokyoExpenses'); 
        if(e) expenses = JSON.parse(e); 
        
        const p = localStorage.getItem('tokyoPlans'); 
        if(p) { plans = JSON.parse(p); } else { plans = JSON.parse(JSON.stringify(defaultPlans)); }
    }
    
    function saveData() { 
        localStorage.setItem('tokyoExpenses', JSON.stringify(expenses)); 
        localStorage.setItem('tokyoPlans', JSON.stringify(plans)); 
    }

    // --- 1. å³æ™‚å¤©æ°£ API ---
    async function fetchWeather() {
        try {
            const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=35.6895&longitude=139.6917&current_weather=true&timezone=Asia%2FTokyo');
            const data = await res.json();
            const temp = Math.round(data.current_weather.temperature);
            const code = data.current_weather.weathercode;
            let emoji = 'â›…', advice = 'é©åˆå‡ºéŠï¼Œæ³¨æ„æ—©æ™šæº«å·®ã€‚';
            
            if(code === 0) { emoji = 'â˜€ï¸'; advice = 'æ™´æœ—å¥½å¤©æ°£ï¼å‡ºé–€è¨˜å¾—é˜²æ›¬ï¼Œæ¡æ´‹è”¥å¼ç©¿æ­ã€‚'; }
            else if(code <= 3) { emoji = 'â›…'; advice = 'å¤šé›²æ™‚æ™´ï¼Œæ°£å€™èˆ’é©ï¼Œéå¸¸é©åˆé€›è¡—ã€‚'; }
            else if(code <= 67) { emoji = 'ğŸŒ§ï¸'; advice = 'é›¨å¤©ï¼å‡ºé–€å‹™å¿…æ”œå¸¶æ‘ºç–Šå‚˜ï¼Œå»ºè­°ç©¿é˜²æ°´é‹ã€‚'; }
            else if(code <= 77) { emoji = 'â„ï¸'; advice = 'ä¸‹é›ªæ©Ÿç‡é«˜ï¼Œè«‹ç©¿è‘—åšå¤–å¥—èˆ‡é˜²æ»‘é‹ä¿æš–ï¼'; }
            
            document.querySelector('.weather-top').innerHTML = `<span>ğŸ“ æ±äº¬å³æ™‚å¤©æ°£ (é»æ“Šçœ‹è©³æƒ…)</span><span style="color:var(--accent-color); font-size:16px;">${emoji} ${temp}Â°C</span>`;
            document.querySelector('.weather-desc').innerText = advice;
        } catch (e) { document.querySelector('.weather-desc').innerText = 'å¤©æ°£é€£ç·šå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚'; }
    }

    function scrollToTop() { 
        document.getElementById('main-content').scrollTo({ top: 0, behavior: 'smooth' }); 
    }

    // --- 2. å®Œæ•´è¡Œç¨‹è³‡æ–™åº« ---
    const scheduleData =[
        {
            day: "Day 1", date: "3/12 (å››)", title: "æ·ºè‰ä¸‹ç”º", icon: "ğŸ®",
            items:[
                { time: "06:15-10:35", title: "æ­ä¹˜ è™èˆª IT200", desc: "æ¡ƒåœ’(TPE) â†’ æˆç”°(NRT)" },
                { time: "11:20-12:10", title: "æ©Ÿå ´ç§»å‹•è‡³ä¸Šé‡", desc: "æ­ä¹˜ Skyliner (è»Šç¨‹ç´„41åˆ†) â†’ äº¬æˆä¸Šé‡", tip: "äº¬æˆä¸Šé‡ç«™å‡ºä¾†å°±æ˜¯ä¸å¿æ± ï¼Œèµ°åˆ°é£¯åº—å¯„æ”¾è¡Œæç´„5-7åˆ†ã€‚", nav: "äº¬æˆä¸Šé‡ç«™åˆ°APAé£¯åº—" },
                { 
                    time: "12:30-13:30", title: "åˆé¤ï¼šä¸Šé‡å‘¨é‚Š", desc: "å¯„æ”¾è¡Œæå¾Œè¦“é£Ÿæ¨è–¦ï¼š",
                    subSpots:[
                        { name: "åä»£ å®‡å¥ˆã¨ã¨ (é°»é­šé£¯)", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>é›™å±¤é°»é­šé£¯<br><b>æ—¥æ–‡ï¼š</b>ã†ãªä¸¼ãƒ€ãƒ–ãƒ« (Unadon Double)<br>â€»é€šå¸¸éœ€è¦æ’éšŠã€‚</div>", nav: "åä»£ å®‡å¥ˆã¨ã¨ ä¸Šé‡åº—" },
                        { name: "é´¨toè”¥ (æ‹‰éºµ)", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>é´¨è‚‰æ‹‰éºµ<br><b>æ—¥æ–‡ï¼š</b>é´¨ã‚‰ãƒ¼ã‚ã‚“ (Kamo Ramen)<br>â€»æ’éšŠååº—ï¼Œéœ€å…ˆè³¼è²·é£Ÿåˆ¸å†æ’ã€‚</div>", nav: "é´¨toè‘±" }
                    ]
                },
                { 
                    time: "13:30-16:30", title: "æ·ºè‰å·¡ç¦®", desc: "åœ°éµï¼šéŠ€åº§ç·š ä¸Šé‡ â†’ æ·ºè‰ 1è™Ÿå‡ºå£",
                    subSpots:[
                        { name: "æ·ºè‰æ–‡åŒ–è§€å…‰ä¸­å¿ƒ", desc: "8æ¨“å…è²»å±•æœ›å°ï¼Œå¯æ‹é›·é–€å…¨æ™¯ã€‚", nav: "æ·ºè‰æ–‡åŒ–è§€å…‰ä¸­å¿ƒ" },
                        { name: "æ·ºè‰é›·é–€ & ä»²è¦‹ä¸–é€š", desc: "å…¥å¯ºå…ˆåœ¨é›·é–€é èº¬ã€‚", nav: "æ·ºè‰é›·é–€", link: "https://www.senso-ji.jp/" },
                        { name: "ã‚ˆã‚ã—åŒ–ç²§å ‚ ä»²è¦‹ä¸–åº—", desc: "æ¨è–¦è³¼è²· 365 å¤©ç”Ÿæ—¥è­·æ‰‹éœœã€‚", nav: "ã‚ˆã‚ã—åŒ–ç²§å ‚ ä»²è¦‹ä¸–åº—" },
                        { name: "é›·ä¸€èŒ¶ / å£½ã€…å–œåœ’", desc: "å¿…åƒä¸–ç•Œæœ€æ¿ƒæŠ¹èŒ¶å†°æ·‡æ·‹ï¼è¨˜å¾—è²·æŠ¹èŒ¶ç²‰ã€‚", nav: "å£½ã€…å–œåœ’ æµ…è‰æœ¬åº—" }
                    ]
                },
                { 
                    time: "16:30-17:00", title: "ç§»å‹•è‡³æ™´ç©ºå¡”", desc: "æ­¥è¡Œèµ° SUMIDA RIVER WALK (ç´„20åˆ†)", tip: "æ²¿é€”å¯æ‹æœæ—¥å•¤é…’é‡‘è‰²ä¾¿ä¾¿ğŸ’©ã€‚ä¸æƒ³èµ°ä¹Ÿå¯æ­æ·ºè‰ç·šåªéœ€3åˆ†é˜ç›´é”æŠ¼ä¸Šç«™ï¼", nav: "æ·ºè‰åˆ°æ™´ç©ºå¡”",
                    subSpots:[
                        { name: "æ²³æ´¥æ«»èˆ‡æ™´ç©ºå¡”æ‹æ”é»", desc: "ä½æ–¼æ±æ­¦æ©‹é™„è¿‘ (1 Chome-18 Narihira)ï¼Œæ˜¯æ•æ‰åˆæ˜¥æ«»èŠ±èˆ‡æ™´ç©ºå¡”åŒæ¡†çš„çµ•ä½³æ©Ÿä½ï¼", nav: "1 Chome-18 Narihira, Sumida City" }
                    ]
                },
                { 
                    time: "17:00-19:00", title: "æ±äº¬æ™´ç©ºå¡”", desc: "ã€å·²è¨‚ç¥¨ 17:00 å…¥å ´ã€‘",
                    subSpots:[
                        { name: "å±•æœ›å° (Tembo Deck)", desc: "å¯åŒæ™‚çœ‹æ—¥è½èˆ‡å¤œæ™¯ã€‚", nav: "æ±äº¬æ™´ç©ºå¡”", link: "https://www.tokyo-skytree.jp/tw/" },
                        { name: "å¯¶å¯å¤¢ä¸­å¿ƒ (East Yard 4F)", desc: "å¿…è²·ï¼šæ™´ç©ºå¡”é™å®šçš®å¡ä¸˜ï¼", nav: "Pokemon Center Skytree" }
                    ]
                },
                { 
                    time: "19:00-20:30", title: "æ™šé¤ï¼šSolamachi", desc: "å•†å ´å…§è§£æ±ºæ™šé¤æ¨è–¦ï¼š",
                    subSpots:[
                        { name: "å…­å˜èˆ (æ²¾éºµ)", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>ç‰¹è£½æ²¾éºµ<br><b>æ—¥æ–‡ï¼š</b>ç‰¹è£½ã¤ã‘ã‚ã‚“ (Tokusei Tsukemen)</div>", nav: "å…­å˜èˆ TOKYO ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼ã‚¿ã‚¦ãƒ³ãƒ»ã‚½ãƒ©ãƒãƒåº—" },
                        { name: "åˆ©ä¹…ç‰›èˆŒ", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>ç‰›èˆŒå®šé£Ÿ<br><b>æ—¥æ–‡ï¼š</b>ç‰›ãŸã‚“å®šé£Ÿ (Gyutan Teishoku)</div>", nav: "ç‰›ãŸã‚“ç‚­ç„¼ åˆ©ä¹… æ±äº¬ã‚½ãƒ©ãƒãƒåº—" }
                    ]
                },
                { 
                    time: "20:30-", title: "è¿”å›ä¸Šé‡ / æ™šé–“æ´»å‹•", desc: "åœ°éµï¼šæŠ¼ä¸Š â†’ ä¸Šé‡",
                    subSpots:[
                        { name: "æ·ºè‰å¯º å¤œé–“é»ç‡ˆ", desc: "å›ç¨‹é †è·¯æ‹æ²’äººçš„é›·é–€å¤œæ™¯ã€‚", nav: "æ·ºè‰å¯º" },
                        { name: "æµ…è‰ROXã¾ã¤ã‚Šæ¹¯", desc: "ç‡Ÿæ¥­è‡³éš”æ—¥ 09:00ï¼Œå¯æ³¡æ¹¯æ”¾é¬†ã€‚", nav: "æµ…è‰ROXã¾ã¤ã‚Šæ¹¯", link: "https://www.matsuri-yu.com/" },
                        { name: "æ²»ä¸€éƒ è²·å¸ƒä¸", desc: "Ecuteä¸Šé‡åº—å…§ã€‚æ³¨æ„ç‡Ÿæ¥­è‡³ 22:00ï¼", nav: "æ²»ä¸€éƒ ecuteä¸Šé‡åº—" },
                        { name: "å”å‰è¨¶å¾· å¾¡å¾’ç”ºåº—", desc: "ç¡ä¸è‘—å¯å»é€›ï¼Œç‡Ÿæ¥­è‡³åŠå¤œ 1:00ã€‚", nav: "å”å‰è¨¶å¾· å¾¡å¾’ç”ºåº—" }
                    ]
                }
            ],
            mapData:[{ name: "äº¬æˆä¸Šé‡ç«™", lat: 35.7114, lng: 139.7746, type: "transport" }, { name: "æ·ºè‰é›·é–€", lat: 35.7147, lng: 139.7967, type: "attraction" }, { name: "æ²³æ´¥æ«»æ‹æ”é»", lat: 35.7103, lng: 139.8115, type: "attraction" }, { name: "æ±äº¬æ™´ç©ºå¡”", lat: 35.7100, lng: 139.8107, type: "attraction" }, { name: "å…­å˜èˆ TOKYO", lat: 35.7101, lng: 139.8122, type: "food" }, { name: "å”å‰è¨¶å¾· å¾¡å¾’ç”º", lat: 35.7075, lng: 139.7730, type: "food" }]
        },
        {
            day: "Day 2", date: "3/13 (äº”)", title: "æ½®æµæ¾€è°·", icon: "ğŸ›ï¸",
            items:[
                { 
                    time: "08:00-09:45", title: "ä¸­ç›®é»‘æ™¨é–“æ•£æ­¥", desc: "åœ°éµï¼šæ—¥æ¯”è°·ç·š ä¸Šé‡ â†’ ä¸­ç›®é»‘",
                    subSpots:[
                        { name: "æ˜Ÿå·´å…‹è‡»é¸Â® æ±äº¬çƒ˜ç„™å·¥åŠ", desc: "<div class='menu-tip'>âš ï¸<b>å¯æå‰1å¤©è‡³å®˜ç¶²é ç´„æŠ½è™Ÿã€‚</b><br>1Fï¼šå’–å•¡èˆ‡Princiçƒ˜ç„™ (æ¨:å¯é ŒéºµåŒ…)<br>2Fï¼šTEAVANAèŒ¶ç“¦ç´ (æ¨:æŠ¹èŒ¶é®®å¥¶æ²¹è˜‡æ‰“)<br>3Fï¼šé…’å§èˆ‡<b>å¿…å»çµ•ç¾æˆ¶å¤–éœ²å°</b><br><b>æ¨è–¦é£²å“ï¼š</b>æœ¨æ¡¶ç²¾é‡€å†·èƒå’–å•¡ (Barrel-Aged Cold Brew)</div>", nav: "æ˜Ÿå·´å…‹è‡»é¸æ±äº¬çƒ˜ç„™å·¥åŠ", link: "https://www.starbucks.co.jp/reserve/roastery/entry-guide/" },
                        { name: "Iâ€™m donut ?", desc: "10:00é–‹é–€ï¼Œè¶…äººæ°£ç”Ÿç”œç”œåœˆã€‚", nav: "Iâ€™m donut ? ä¸­ç›®é»‘" }
                    ]
                },
                { time: "09:45-10:30", title: "æ˜æ²»ç¥å®®", desc: "åƒæ‹œæµç¨‹ï¼šé³¥å±…å‰ä¸€é èº¬ â†’ èµ°åƒé“å…©å´", nav: "æ˜æ²»ç¥å®®", link: "https://www.meijijingu.or.jp/guide/" },
                { 
                    time: "10:30-13:30", title: "åŸå®¿è¡¨åƒé“é€›è¡—", desc: "æ³¨æ„ï¼šå¤šæ•¸åº—å®¶ 11:00 é–‹é–€",
                    subSpots:[
                        { name: "ä¼Šè‰¯å¯æ¨‚ æ¸‹è°·ç¥å®®å‰", desc: "æ—¥æœ¬è¶…ç´…æ‰‹å·¥ç²¾é‡€å¯æ¨‚ã€‚", nav: "ä¼Šè‰¯å¯æ¨‚ æ¸‹è°·ç¥å®®å‰" },
                        { name: "#C-pla+ åŸå®¿ç«¹ä¸‹é€šåº—", desc: "09:30é–‹é–€ï¼Œè¶…å¤§æ‰­è›‹åº—ã€‚", nav: "#C-pla åŸå®¿" },
                        { name: "and ST (æ——è‰¦åº—)", desc: "11:00é–‹é–€ï¼ŒåŸå®¿ç«™å‡ºå£å°é¢ã€‚", nav: "and ST åŸå®¿" },
                        { name: "æ±æ€¥å»£å ´ åŸè§’ (HARAKADO)", desc: "å¹³ç”°æ™ƒä¹…è¨­è¨ˆï¼Œé ‚æ¨“æœ‰è¶…ç¾æˆ¶å¤–éœ²è‡ºã€‚", nav: "æ±æ€¥ãƒ—ãƒ©ã‚¶åŸå®¿ã€Œãƒãƒ©ã‚«ãƒ‰ã€" },
                        { name: "NUMBER SUGAR", desc: "æ¨è–¦ï¼šNo.1é¦™è‰ã€No.2æµ·é¹½ã€‚", nav: "NUMBER SUGAR è¡¨åƒé“" },
                        { name: "è¡¨åƒé“ä¹‹ä¸˜", desc: "å®‰è—¤å¿ é›„è¨­è¨ˆï¼Œæ–œå¡èµ°é“èˆ‡æŒ‘é«˜ç©ºé–“æ˜¯æ‹ç…§äº®é»ã€‚", nav: "è¡¨åƒé“ä¹‹ä¸˜" },
                        { name: "BEAMS & HOKA åŸå®¿", desc: "éƒ½åœ¨é™„è¿‘ï¼Œå¯é †è·¯é€›ã€‚", nav: "BEAMS åŸå®¿" }
                    ]
                },
                { 
                    time: "13:30-14:30", title: "åˆé¤ï¼šSuage æ¹¯å’–å“©", desc: "ææ—©åƒé¿é–‹å°–å³°ã€‚", 
                    subSpots:[
                        { name: "é»é¤æ¨è–¦", desc: "<div class='menu-tip'><b>æ¨è–¦ä¸»é¤ï¼š</b>è„†çš®çŸ¥åºŠé›è‚‰è”¬èœå’–å“©<br><b>æ—¥æ–‡ï¼š</b>ãƒ‘ãƒªãƒ‘ãƒªçŸ¥åºŠé¶ã¨é‡èœã‚«ãƒ¬ãƒ¼<br><b>å¿…åŠ é»ï¼š</b>ç‚¸èŠ±æ¤°èœ (æšã’ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼)</div>", nav: "Suageæ¾€è°·åº—" }
                    ]
                },
                { 
                    time: "14:30-18:00", title: "ç¥å—å€èˆ‡æ¾€è°·é€›è¡—", desc: "ä¸€è·¯å¾€å—é€›å›è»Šç«™",
                    subSpots:[
                        { name: "FREAK'S STORE / HOKA", desc: "ç¥å—å€æ½®æµé¸ç‰©åº—ã€‚", nav: "FREAK'S STORE æ¾€è°·" },
                        { name: "ä»»å¤©å ‚ æ±äº¬æ——è‰¦åº— ğŸ„", desc: "ä½æ–¼ PARCO 6Fã€‚", nav: "Nintendo TOKYO" },
                        { name: "å¯¶å¯å¤¢ä¸­å¿ƒ ğŸ”´", desc: "ä½æ–¼ PARCO 6Fã€‚", nav: "Pokemon Center Shibuya" }
                    ]
                },
                { 
                    time: "18:00-", title: "æ™šé¤ï¼šæ¾€è°·å‘¨é‚Š", desc: "æ‹ç…§å¾Œåƒæ™šé¤ (æ¨è–¦å…é ç´„)ï¼š",
                    subSpots:[
                        { name: "æ´»ç¾ç™»åˆ© è¿´è½‰å£½å¸", desc: "<div class='menu-tip'>ä½æ–¼æ¾€è°·è¥¿æ­¦ç™¾è²¨ 8Fã€‚éœ€æŠ½è™Ÿç¢¼ç‰Œï¼Œä½†ç¿»æ¡Œå¿«CPå€¼æ¥µé«˜ï¼</div>", nav: "æ´»ç¾ç™»åˆ© è¥¿æ­¦æ¸‹è°·åº—" },
                        { name: "å±±å®¶ç‚¸è±¬æ’ (å›ä¸Šé‡åƒ)", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>ç‚¸é‡Œè‚Œè±¬æ’å®šé£Ÿ<br><b>æ—¥æ–‡ï¼š</b>ãƒ­ãƒ¼ã‚¹ã‹ã¤å®šé£Ÿ (Rosu Katsu Teishoku)</div>", nav: "å±±å®¶ ä¸Šé‡åº—" }
                    ]
                }
            ],
            mapData:[{ name: "æ˜Ÿå·´å…‹è‡»é¸", lat: 35.6486, lng: 139.6934, type: "food" }, { name: "æ˜æ²»ç¥å®®", lat: 35.6764, lng: 139.6993, type: "attraction" }, { name: "NUMBER SUGAR", lat: 35.6672, lng: 139.7061, type: "food" }, { name: "Suage æ¾€è°·åº—", lat: 35.6593, lng: 139.7032, type: "food" }, { name: "æ¾€è°· PARCO", lat: 35.6622, lng: 139.6987, type: "food" }]
        },
        { 
            day: "Day 3", date: "3/14 (å…­)", title: "æ± è¢‹æ–°å®¿", icon: "ğŸ‘¾",
            items:[
                { 
                    time: "10:00-13:00", title: "æ± è¢‹ Sunshine City", desc: "JRå±±æ‰‹ç·šå‰å¾€", 
                    subSpots:[
                        { name: "å¯¶å¯å¤¢ä¸­å¿ƒ MEGA TOKYO", desc: "æ——è‰¦åº—ç´šåˆ¥ã€‚", nav: "Pokemon Center Mega Tokyo" },
                        { name: "è½‰è›‹çš„æ£®æ—", desc: "è¶…å¤§å‹æ‰­è›‹æ¨‚åœ’ã€‚", nav: "ã‚¬ã‚·ãƒ£ãƒãƒ³ã®ãƒ‡ãƒ‘ãƒ¼ãƒˆæ± è¢‹ç·æœ¬åº—" }
                    ]
                }, 
                { 
                    time: "13:00-14:00", title: "åˆé¤ï¼šæ± è¢‹å‘¨é‚Š", desc: "é€›å®Œåƒåˆé¤", 
                    subSpots:[
                        { name: "Miura no Hamburg", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>æ‰‹å·¥æ¼¢å ¡æ’<br><b>æ—¥æ–‡ï¼š</b>æ‰‹ã”ã­ãƒãƒ³ãƒãƒ¼ã‚° (Hamburg)</div>", nav: "ä¸‰æµ¦ã®ãƒãƒ³ãƒãƒ¼ã‚° æ± è¢‹" },
                        { name: "éºµå‰µæˆ¿ ç„¡æ•µå®¶", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>æœ¬ä¸¸éºµ (æ‹›ç‰Œè±¬éª¨æ‹‰éºµ)<br><b>æ—¥æ–‡ï¼š</b>æœ¬ä¸¸éºº (Honmaru Men)<br>â€»ç¶“å¸¸å¤§æ’é•·é¾ã€‚</div>", nav: "éººå‰µæˆ¿ ç„¡æ•µå®¶" }
                    ]
                }, 
                { 
                    time: "14:00-16:30", title: "æ–°å®¿é€›è¡—", desc: "JRå±±æ‰‹ç·šï¼šæ± è¢‹ â†’ æ–°å®¿", 
                    subSpots:[
                        { name: "LUMINE EST æ–°å®¿ (B1)", desc: "è²· Pensta (ä¼éµå‘¨é‚Š)ã€‚", nav: "LUMINE EST" },
                        { name: "ä¼Šå‹¢ä¸¹æ–°å®¿åº— ç”·å£«é¤¨", desc: "æ—¥æœ¬æœ€å¼·ç”·è£ç™¾è²¨ã€‚", nav: "ä¼Šå‹¢ä¸¹ æ–°å®¿åº— ç”·é¤¨" },
                        { name: "KIDDY LAND æ–°å®¿åº—", desc: "å‹•æ¼«å‘¨é‚Šã€‚", nav: "KIDDY LAND æ–°å®¿" },
                        { name: "BEAMS JAPAN æ–°å®¿", desc: "è²©å”®æ—¥æœ¬ç‰¹è‰²èˆ‡æœé£¾ã€‚", nav: "BEAMS JAPAN æ–°å®¿" },
                        { name: "KEN BOX", desc: "è¿·ä½ è»Šæ¨¡å‹å°ˆè³£åº—ã€‚", nav: "ãƒŸãƒ‹ã‚«ãƒ¼ã‚·ãƒ§ãƒƒãƒ— ã‚±ãƒ³ãƒœãƒƒã‚¯ã‚¹" },
                        { name: "æ–°å®¿æ±å¯¶å¤§æ¨“", desc: "æ‹æ”å“¥å‰æ‹‰å¤§é ­ã€‚", nav: "æ–°å®¿æ±å®ãƒ“ãƒ«" },
                        { name: "æ±æ€¥æ­Œèˆä¼ç”ºTOWER", desc: "æ–°å®¿æ–°åœ°æ¨™ï¼Œçµåˆéœ“è™¹å±…é…’å±‹ã€‚", nav: "æ±æ€¥æ­Œèˆä¼ç”ºã‚¿ãƒ¯ãƒ¼" }
                    ]
                }, 
                { 
                    time: "16:30-17:30", title: "æ™šé¤ï¼šæ–°å®¿å‘¨é‚Š", desc: "ææ—©åƒé¿é–‹äººæ½®ã€‚",
                    subSpots:[
                        { name: "æ… Udon (çƒé¾éºµ)", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>ç«¹ç°å†·çƒé¾éºµ<br><b>æ—¥æ–‡ï¼š</b>ã–ã‚‹ã†ã©ã‚“ (Zaru Udon)<br>âš ï¸<b>å¼·çƒˆå»ºè­°ï¼š</b>ä¸€åˆ°æ–°å®¿å…ˆå»åº—é–€å£æ©Ÿå™¨ã€ŒæŠ½æ•´ç†åˆ¸ã€ï¼</div>", nav: "æ… ã†ã©ã‚“" },
                        { name: "é¾ä¹‹å®¶ (æ‹‰éºµ)", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>æ²¾éºµ (é™„ç²¥)<br><b>æ—¥æ–‡ï¼š</b>ã¤ã‘éºº ã‚‚ã¤ (Tsukemen Motsu)</div>", nav: "ãƒ©ãƒ¼ãƒ¡ãƒ³ é¾ã®å®¶ æ–°å®¿ å°æ»æ©‹é€šã‚Šåº—" },
                        { name: "é³¥è²´æ— æ–°å®¿å—å£åº—", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>é«˜CPå€¼çƒ¤è‚‰ä¸²</div>", nav: "é³¥è²´æ— æ–°å®¿å—å£åº—" }
                    ]
                }, 
                { time: "17:30-19:00", title: "æ±äº¬éƒ½å»³ å—å±•æœ›å®¤", desc: "å…è²»çœ‹æ—¥è½èˆ‡å¤œæ™¯ã€‚", tip: "âš ï¸é€²å ´å‰éœ€æª¢æŸ¥åŒ…åŒ…ï¼Œå…¨é¢ç¦æ­¢ä½¿ç”¨è…³æ¶ï¼å»ºè­°å…ˆè‡³å®˜ç¶²ç¢ºèªäººæ•¸ã€‚", link: "https://www.zaimu.metro.tokyo.lg.jp/tochousha/goannai/tenbou", nav: "æ±äº¬éƒ½å»³" }, 
                { time: "19:00-20:30", title: "TOKYO Night & Light", desc: "éƒ½å»³å…‰é›•ç§€ï¼š19:00 é‹¼å½ˆ / 20:00 å“¥å‰æ‹‰", link: "https://tokyoprojectionmappingproject.jp/", nav: "éƒ½æ°‘å»£å ´" }, 
                { 
                    time: "20:30-", title: "æ­Œèˆä¼ç”ºå¤œç”Ÿæ´»", desc: "æ„Ÿå—ç†±é¬§æ°£æ°›èˆ‡æ·±å¤œè–ä»£", 
                    subSpots:[
                        { name: "Parfaiteria beL (å¤œé–“èŠ­è²)", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>é–‹å¿ƒæœèˆ‡å·§å…‹åŠ›èŠ­è² (ãƒ”ã‚¹ã‚¿ãƒã‚ªã¨ãƒ—ãƒ©ãƒªãƒ)<br>åŒ—æµ·é“çˆ†ç´…çš„ã€Œæ”¶å°¾è–ä»£ã€æ–‡åŒ–ï¼Œå¯é»é¸é€£çµçœ‹èœå–®æŒ‡åœ–é»é¤ã€‚</div>", nav: "Parfaiteria beL æ–°å®¿ä¸‰ä¸ç›®", link: "https://tabelog.com/tw/tokyo/A1304/A130401/13245627/dtlmenu/" },
                        { name: "ME TOKYO SHINJUKU", desc: "è¶…å¤§å‹å¤¾å¨ƒå¨ƒæ©Ÿèˆ‡è½‰è›‹ä¸­å¿ƒï¼Œç‡Ÿæ¥­è‡³ 23:30ã€‚", nav: "ME TOKYO SHINJUKU" },
                        { name: "ãƒ†ãƒ«ãƒãƒ¼æ¹¯ (Thermae-Yu)", desc: "24å°æ™‚ç‡Ÿæ¥­çš„è±ªè¯éƒ½æœƒå‹æº«æ³‰ï¼Œé€›ç´¯äº†å¯ä¾†æ³¡æ¹¯æ”¾é¬†ï¼", nav: "ãƒ†ãƒ«ãƒãƒ¼æ¹¯", link: "https://thermae-yu.jp/" }
                    ]
                }
            ], 
            mapData:[{ name: "æ± è¢‹å¤ªé™½åŸ", lat: 35.7289, lng: 139.7193, type: "attraction" }, { name: "æ… ã†ã©ã‚“", lat: 35.6865, lng: 139.6974, type: "food" }, { name: "æ±äº¬éƒ½å»³", lat: 35.6896, lng: 139.6921, type: "attraction" }, { name: "Parfaiteria beL", lat: 35.6908, lng: 139.7058, type: "food" }, { name: "ãƒ†ãƒ«ãƒãƒ¼æ¹¯", lat: 35.6942, lng: 139.7051, type: "attraction" }] 
        },
        { 
            day: "Day 4", date: "3/15 (æ—¥)", title: "å¼·é‹éŠ€åº§", icon: "â›©ï¸",
            items:[
                { time: "07:30-08:00", title: "å‰å¾€å°ç¶²ç¥ç¤¾", desc: "åœ°éµæ—¥æ¯”è°·ç·š ä¸Šé‡ â†’ äººå½¢ç”º" }, 
                { time: "08:00-08:30", title: "å°ç¶²ç¥ç¤¾", desc: "æ´—éŒ¢è¨˜å¾—æº–å‚™ç¡¬å¹£ã€‚", tip: "æ´—å®Œæ“¦ä¹¾æ”¾éŒ¢åŒ…ç•¶éŒ¢æ¯ã€‚åƒæ‹œï¼šäºŒé èº¬ã€äºŒæ‹æ‰‹ã€ä¸€é èº¬ã€‚", nav: "å°ç¶²ç¥ç¤¾" }, 
                { 
                    time: "08:30-09:30", title: "æ—¥æœ¬æ©‹æ•£æ­¥ & å¯¶å¯å¤¢ DX", desc: "æ­¥è¡Œå‰å¾€", 
                    subSpots:[
                        { name: "æ—¥æœ¬æ©‹ éº’éºŸåƒ", desc: "æ±é‡åœ­å¾å°èªªå ´æ™¯ã€‚", nav: "æ—¥æœ¬æ©‹ éº’éºŸåƒ" },
                        { name: "å¯¶å¯å¤¢ä¸­å¿ƒ æ±äº¬ DX", desc: "çµåˆå¯¶å¯å¤¢å’–å•¡å»³ã€‚", nav: "Pokemon Center Tokyo DX" }
                    ]
                }, 
                { 
                    time: "09:30-11:30", title: "æ±äº¬è»Šç«™ä¸€ç•ªè¡—", desc: "å…«é‡æ´²ä¸­å¤®å£ä¸‹æ¨“", 
                    subSpots:[{ name: "æ±äº¬å‹•æ¼«äººç‰©è¡—", desc: "å„é›»è¦–å°å‘¨é‚Šã€‚", nav: "æ±äº¬å‹•æ¼«äººç‰©è¡—" }]
                }, 
                { time: "12:00-13:30", title: "åˆé¤ï¼šç‡’è‚‰ Ushigoro", desc: "ã€å·²é ç´„ 12:00ã€‘", nav: "Ushigoro Ginza" }, 
                { 
                    time: "13:30-16:00", title: "éŠ€åº§æ­¥è¡Œè€…å¤©åœ‹", desc: "é€±æœ«å°è¡—", 
                    subSpots:[
                        { name: "ç„¡å°è‰¯å“ éŠ€åº§æ——è‰¦åº—", desc: "ä¸–ç•Œç´šæ——è‰¦åº—ï¼Œæœ‰å°ˆå±¬ç”Ÿé®®èˆ‡çƒ˜ç„™åŠã€‚", nav: "ç„¡å°è‰¯å“ éŠ€åº§" },
                        { name: "Ginza Sony Park", desc: "éƒ½å¸‚ç«‹é«”å…¬åœ’æ‹ç…§ã€‚", nav: "Ginza Sony Park" },
                        { name: "GINZA SIX", desc: "éŠ€åº§æœ€å¤§å•†æ¥­è¨­æ–½ï¼Œä¸­åº­æœ‰å¤§å¸«è£ç½®è—è¡“ã€‚", nav: "GINZA SIX" },
                        { name: "æ˜Ÿå·´å…‹ TEAVANAâ„¢å°ˆé–€åº—", desc: "èŒ¶ç“¦ç´ä¸»é¡Œæ˜Ÿå·´å…‹ï¼Œ2æ¨“å¯å…§ç”¨ï¼Œæ¨è–¦ç‰¹èª¿èŒ¶é£²ï¼", nav: "Starbucks Coffee - Ginza Marronnier Dori" }
                    ]
                }, 
                { 
                    time: "16:00-18:30", title: "ç§‹è‘‰åŸ", desc: "é›»å™¨è¡—èˆ‡æ¬¡æ–‡åŒ–", 
                    subSpots:[
                        { name: "KENELE STAND", desc: "è»Šç«™å…§ç²¾ç·»æ‰­è›‹ç‰†ã€‚", nav: "KENELE STAND ç§‹è‘‰åŸ" },
                        { name: "Milk Shop LUCK é…ª", desc: "ç¸½æ­¦ç·š6è™Ÿæœˆå°ä¸Šã€‚", nav: "Milk Shop LUCK é…ª", link: "https://tokyo.letsgojp.com/archives/570282/" }
                    ]
                }, 
                { 
                    time: "18:30-19:30", title: "æ±äº¬è»Šç«™ å¤œæ™¯", desc: "æ‹æ”é»ï¼šä¸¸ä¹‹å…§ç«™å‰å»£å ´ / KITTE 6Fã€‚", tip: "ğŸ“· æ‹æ”ç§˜è¨£ï¼šKITTE 6F å±‹é ‚åº­åœ’ç¦ç”¨è…³æ¶ï¼Œè¦æ³¨æ„ç»ç’ƒåå…‰ã€‚è‹¥ä¸‹éé›¨ï¼Œä¸¸ä¹‹å…§å»£å ´åœ°é¢æœƒæœ‰æ¥µç¾çš„ç´…ç£šè»Šç«™å€’å½±ï¼", nav: "KITTEä¸¸ä¹‹å…§" 
                }, 
                { 
                    time: "19:30-", title: "æ™šé¤ï¼šæ±äº¬è»Šç«™å‘¨é‚Š", desc: "å…é ç´„æ¨è–¦åå–®ï¼š",
                    subSpots:[
                        { name: "éº¦ã¨åµ (ç”Ÿç¾©å¤§åˆ©éºµ)", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>ç©¶æ¥µåŸ¹æ ¹è›‹éºµ<br><b>æ—¥æ–‡ï¼š</b>ç©¶æ¥µã®ã‚«ãƒ«ãƒœãƒŠãƒ¼ãƒ©<br>ä½æ–¼å…«é‡æ´²åŒ—å£ï¼Œéºµæ¢è¶…Qå½ˆã€‚</div>", nav: "éº¦ã¨åµ æ±äº¬é§…å…«é‡æ´²åŒ—å£åº—" },
                        { name: "æ¥µå‘³å±‹ æ±äº¬ç«™åº—", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>æ¥µå‘³å±‹æ¼¢å ¡æ’<br><b>æ—¥æ–‡ï¼š</b>æ¥µå‘³ã‚„ãƒãƒ³ãƒãƒ¼ã‚°<br>è‡ªå·±çƒ¤çš„éµæ¿æ¼¢å ¡æ’ï¼Œæ²¹ç…™å‘³é‡éœ€æ³¨æ„ã€‚</div>", nav: "æ¥µå‘³å±‹ æ±äº¬é§…åº—" },
                        { name: "å…­å˜èˆ (æ‹‰éºµè¡—)", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>ç‰¹è£½æ²¾éºµ<br><b>æ—¥æ–‡ï¼š</b>ç‰¹è£½ã¤ã‘ã‚ã‚“</div>", nav: "å…­å˜èˆ æ±äº¬ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚¹ãƒˆãƒªãƒ¼ãƒˆ" },
                        { name: "æ ¹å®¤èŠ±ä¸¸ è¿´è½‰å£½å¸", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>ç”Ÿå¹²è² (ç”Ÿã»ãŸã¦) / é®­é­š (ã‚µãƒ¼ãƒ¢ãƒ³)<br>ä½æ–¼KITTE 5Fã€‚âš ï¸å»ºè­°ææ—©ä¸Šæ¨“æŠ½è™Ÿç¢¼ç‰Œï¼</div>", nav: "å›è»¢å¯¿å¸ æ ¹å®¤èŠ±ã¾ã‚‹ KITTEä¸¸ã®å†…åº—" }
                    ]
                }
            ], 
            mapData:[{ name: "å°ç¶²ç¥ç¤¾", lat: 35.6845, lng: 139.7820, type: "attraction" }, { name: "Pokemon Center Tokyo DX", lat: 35.6806, lng: 139.7735, type: "food" }, { name: "Ushigoro Ginza", lat: 35.6740, lng: 139.7680, type: "food" }, { name: "KITTEä¸¸ä¹‹å…§", lat: 35.6800, lng: 139.7661, type: "attraction" }] 
        },
        { 
            day: "Day 5", date: "3/16 (ä¸€)", title: "éº»å¸ƒå°è—è¡“", icon: "ğŸ—¼",
            items:[
                { time: "08:15-09:00", title: "å‰å¾€ TeamLab", desc: "åœ°éµæ—¥æ¯”è°·ç·š ä¸Šé‡ â†’ ç¥è°·ç”º" }, 
                { time: "09:00-11:00", title: "TeamLab Borderless", desc: "ã€å·²è¨‚ç¥¨ 09:00 å…¥å ´ã€‘", nav: "éº»å¸ƒå°ä¹‹ä¸˜" }, 
                { 
                    time: "11:00-12:00", title: "éº»å¸ƒå°ä¹‹ä¸˜", desc: "Heatherwickç¶²æ ¼å»ºç¯‰èˆ‡è—è¡“è¡—å€", tip: "âš ï¸33Fè§€æ™¯å°æ–°åˆ¶ï¼šéœ€è‡³æŒ‡å®šé¤å»³æ¶ˆè²»ã€‚B1æ­S1é›»æ¢¯è‡³33Fï¼Œæˆ–1Fæ­S2é›»æ¢¯è‡³34Fã€‚", link: "https://platinumaps.jp/d/azabudaihills", 
                    subSpots:[
                        { name: "ğŸ“ å®˜æ–¹é›»å­åœ°åœ–", desc: "é»æ“Šå³æ–¹æŒ‰éˆ•é–‹å•Ÿå®˜æ–¹å°èˆªåœ–ã€‚", link: "https://platinumaps.jp/d/azabudaihills" },
                        { name: "ä¸­å¤®å»£å ´ (Central Green)", desc: "æ³¢æµªç¶²æ ¼å»ºç¯‰ï¼Œè‰çš®ä¸Šæœ‰å…¬å…±è—è¡“è£ç½®ï¼Œæ‹æ”æ±äº¬éµå¡”çµ•ä½³è¦–è§’ã€‚", nav: "éº»å¸ƒå°ä¹‹ä¸˜ ä¸­å¤®å»£å ´" },
                        { name: "% ARABICA å’–å•¡", desc: "<div class='menu-tip'>äº¬éƒ½è¶…äººæ°£å’–å•¡ï¼æ¨è–¦å»4Fæœ‰çµ•ç¾æˆ¶å¤–éœ²è‡ºã€‚<br><b>æ¨è–¦ï¼š</b>äº¬éƒ½æ‹¿éµ (Kyoto Latte)</div>", nav: "% ARABICA Tokyo Azabudai Hills 4F" },
                        { name: "Sky Room Cafe (34F)", desc: "<div class='menu-tip'>æ­S2é›»æ¢¯ã€‚ä½æ¶ˆé£²æ–™ç´„ Â¥800 â• å…¥å ´è²» Â¥500ã€‚åƒ…æ”¶åˆ·å¡/é›»å­æ”¯ä»˜ã€‚</div>", nav: "Hills House Sky Room Cafe & Bar", link: "https://tokyo.letsgojp.com/archives/632958/" },
                        { name: "Ã‰CHIRÃ‰ è‰¾è¨±å¥¶æ²¹ (1F)", desc: "<div class='menu-tip'><b>æ¨è–¦å¿…è²·ï¼š</b>å¥¶æ²¹ç•ŒLVï¼Œå¯é Œèˆ‡éµç›’é¤…ä¹¾<br><b>æ—¥æ–‡ï¼š</b>ã‚¯ãƒ­ãƒ¯ãƒƒã‚µãƒ³ (å¯é Œ)</div>", nav: "Ã‰CHIRÃ‰ L'Atelier du Beurre" }
                    ]
                }, 
                { 
                    time: "12:00-13:00", title: "åˆé¤ï¼šé°»ã®æˆç€¬ å…­æœ¬æœ¨åº—", desc: "é«˜CPå€¼å…é ç´„é°»é­šé£¯", 
                    subSpots:[
                        { name: "é»é¤æ¨è–¦", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>é°»é­šé‡ æ¾ (æ•´å°¾ä»½é‡æœ€å¤§)<br><b>æ—¥æ–‡ï¼š</b>ã†ãªé‡ æ¾ (Unaju Matsu)</div>", nav: "é°»ã®æˆç€¬ å…­æœ¬æœ¨åº—" }
                    ]
                }, 
                { 
                    time: "13:00-15:30", title: "å…­æœ¬æœ¨è—è¡“æ•£ç­–", desc: "ç¾è¡“é¤¨èˆ‡è¡—å€äº®é»", 
                    subSpots:[
                        { name: "åœ‹ç«‹æ–°ç¾è¡“é¤¨", desc: "é»‘å·ç´€ç« è¨­è¨ˆï¼Œæ³¢æµªç»ç’ƒæ¥µå…·æœªä¾†æ„Ÿã€‚<div class='menu-tip'>ğŸ“·<b>äº®é»ï¼š</b>2Fåœ“éŒä¸Šçš„å’–å•¡å»³æ˜¯ã€Šä½ çš„åå­—ã€‹ç”·ä¸»è§’ç´„æœƒå–æ™¯åœ°ï¼</div>", nav: "åœ‹ç«‹æ–°ç¾è¡“é¤¨", link: "https://www.nact.jp/" },
                        { name: "21_21 DESIGN SIGHT", desc: "å®‰è—¤å¿ é›„èˆ‡ä¸‰å®…ä¸€ç”Ÿæ‰“é€ ã€‚å±‹é ‚å¦‚æŠ˜å½çš„éµæ¿ï¼Œæ¥µç°¡æ¸…æ°´æ¨¡è¶…å¥½æ‹ã€‚", nav: "21_21 DESIGN SIGHT" },
                        { name: "å…­æœ¬æœ¨ä¹‹ä¸˜", desc: "å¿…æ‹å·¨å¤§èœ˜è››é›•å¡‘(Maman)ã€æ¯›åˆ©åº­åœ’ã€‚", nav: "å…­æœ¬æœ¨ä¹‹ä¸˜" }
                    ]
                }, 
                { 
                    time: "16:00-18:30", title: "ä¸Šé‡ é˜¿ç¾æ©«ä¸", desc: "æœ€å¾Œæ¡è²·", 
                    subSpots:[
                        { name: "Yamashiroya ç©å…·åº—", desc: "å…­å±¤æ¨“ç©å…·å¤©å ‚ã€‚", nav: "Yamashiroya" },
                        { name: "OS Drug ä¸Šé‡åº—", desc: "è¶…ä¾¿å®œè—¥å¦ï¼åªæ”¶ç¾é‡‘ã€‚", nav: "OS Drug ä¸Šé‡" },
                        { name: "äºŒæœ¨è“å­", desc: "æ‰“çƒŠæ™‚é–“ï¼š20:00ã€‚", nav: "äºŒæœ¨è“å­ ç¬¬ä¸€ç‡Ÿæ¥­æ‰€" }
                    ]
                }, 
                { 
                    time: "18:30-19:30", title: "æ™šé¤ï¼šä¸Šé‡å‘¨é‚Š", desc: "æ¨è–¦åå–®ï¼š",
                    subSpots:[
                        { name: "é³¥è²´æ— ä¸Šé‡ä¸­å¤®é€šåº—", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>çƒ¤é›è…¿è‚‰ä¸² (é†¬æ±/é¹½å‘³)<br><b>æ—¥æ–‡ï¼š</b>ã‚‚ã‚‚è²´æ—ç„¼ ãŸã‚Œ/å¡© (Momo Kizokuyaki)</div>", nav: "é³¥è²´æ— ä¸Šé‡ä¸­å¤®é€šåº—" },
                        { name: "è‚‰çš„å¤§å±±", desc: "<div class='menu-tip'><b>æ¨è–¦ï¼š</b>ç‰¹è£½ç‚¸è‚‰é¤…<br><b>æ—¥æ–‡ï¼š</b>ã‚„ã¿ã¤ããƒ¡ãƒ³ãƒ (Yamitsuki Menchi)</div>", nav: "è‚‰ã®å¤§å±± ä¸Šé‡åº—" },
                        { name: "ç£¯ä¸¸æ°´ç”¢", desc: "24å°æ™‚ç‡Ÿæ¥­çš„æµ·é®®å±…é…’å±‹ã€‚", nav: "ç£¯ä¸¸æ°´ç”£ ä¸Šé‡6ä¸ç›®åº—" }
                    ]
                }, 
                { time: "19:30-20:00", title: "å›é£¯åº—æ”¾æ±è¥¿", desc: "æ¸›è¼•è² æ“”å†å‡ºé–€" }, 
                { time: "20:00-", title: "èŠå…¬åœ’ æ‹æ”æ±äº¬éµå¡”", desc: "å‰å¾€ 7-11 èŠ3ä¸ç›®åº—æ‹æ”ã€‚", nav: "7-Eleven æ¸¯åŒºèŠ3ä¸ç›®åº—" }
            ], 
            mapData:[{ name: "éº»å¸ƒå°ä¹‹ä¸˜", lat: 35.6612, lng: 139.7397, type: "attraction" }, { name: "åœ‹ç«‹æ–°ç¾è¡“é¤¨", lat: 35.6652, lng: 139.7263, type: "attraction" }, { name: "é³¥è²´æ— ä¸Šé‡", lat: 35.7102, lng: 139.7733, type: "food" }, { name: "7-11 èŠ3ä¸ç›®", lat: 35.6585, lng: 139.7454, type: "attraction" }] 
        },
        { 
            day: "Day 6", date: "3/17 (äºŒ)", title: "è¿”ç¨‹", icon: "âœˆï¸",
            items:[
                { 
                    time: "09:30-10:00", title: "é€€æˆ¿ & å¯„æ”¾è¡Œæ", desc: "âš ï¸è«‹ç›¡æ—©å»æ¶äº¬æˆä¸Šé‡ç«™ç½®ç‰©æ«ƒã€‚", 
                    subSpots:[
                        { name: "äº¬æˆä¸Šé‡ç«™ ç½®ç‰©æ«ƒ", desc: "ä½æ–¼ Skyliner å‰ªç¥¨å£æ—ï¼Œå¾€ä¸Šé‡å‹•ç‰©åœ’æ–¹å‘å‡ºå£ã€‚", nav: "äº¬æˆä¸Šé‡ç«™", link: "https://marifoodie.com/ueno-station-lockers/" }
                    ]
                }, 
                { 
                    time: "10:00-11:15", title: "ä¸Šé‡æ©è³œå…¬åœ’", desc: "æ•£æ­¥ / å¿…æ‹æ™¯é»", tip: "ğŸ“· å¿…æ‹ï¼šä¸å¿æ± èˆ‡å¼å¤©å ‚ã€æœ¨é€ å»ºç¯‰çš„æ˜Ÿå·´å…‹ã€ç¥ˆæ±‚å¥½é‹çš„ä¸Šé‡å¤§ä½›ã€‚", nav: "ä¸Šé‡æ©è³œå…¬åœ’" 
                }, 
                { 
                    time: "11:30-12:45", title: "åˆé¤ï¼šäººå½¢ç”ºä»ŠåŠ", desc: "ã€å·²é ç´„ 11:30ã€‘", 
                    subSpots:[
                        { name: "é»é¤å»ºè­°", desc: "<div class='menu-tip'><b>å¿…åƒï¼š</b>å£½å–œç‡’å¥—é¤<br><b>æ—¥æ–‡ï¼š</b>ã™ãç„¼ã (Sukiyaki)</div>", nav: "äººå½¢ç”ºä»ŠåŠ ä¸Šé‡å»£å°è·¯åº—" }
                    ]
                }, 
                { time: "13:00-13:45", title: "æ­ä¹˜ Skyliner å‰å¾€æ©Ÿå ´", desc: "13:00ç™¼è»Šï¼Œâš ï¸æ¥µé™ç­æ¬¡13:20" }, 
                { time: "15:40-", title: "æ­ä¹˜ æ˜Ÿå®‡ JX803 è¿”å°", desc: "æˆç”°(NRT) â†’ æ¡ƒåœ’(TPE)" }
            ], 
            mapData:[{ name: "äº¬æˆä¸Šé‡ç«™", lat: 35.7114, lng: 139.7746, type: "transport" }, { name: "ä¸Šé‡æ©è³œå…¬åœ’", lat: 35.7140, lng: 139.7730, type: "attraction" }, { name: "äººå½¢ç”ºä»ŠåŠ", lat: 35.7082, lng: 139.7725, type: "food" }, { name: "æˆç”°æ©Ÿå ´", lat: 35.7719, lng: 140.3928, type: "transport" }] 
        }
    ];

    window.onload = () => {
        loadData();
        fetchWeather();
        renderDateChips();
        selectDay(0, 'schedule');
        selectDay(0, 'map');
        renderExpenses();
        renderPlans();
    };

    function switchTab(tabId, element) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(`tab-${tabId}`).classList.add('active');
        element.classList.add('active');

        const weatherObj = document.getElementById('weather-display');
        if(tabId === 'expense' || tabId === 'planning') { 
            weatherObj.style.display = 'none'; 
        } else { 
            weatherObj.style.display = 'block'; 
        }
        
        if(tabId === 'map' && map) { 
            setTimeout(() => { map.invalidateSize(); }, 100); 
        }
    }

    function jumpToBookings() { 
        document.getElementById('nav-bookings').click(); 
    }

    function renderDateChips() {
        const schedContainer = document.getElementById('date-picker-schedule');
        const mapContainer = document.getElementById('date-picker-map');
        
        scheduleData.forEach((day, index) => {
            const createChip = (container, type) => {
                const chip = document.createElement('div');
                chip.className = `date-chip ${index === 0 ? 'active' : ''}`;
                chip.innerHTML = `${day.day}<br><span style="font-weight:400; font-size:11px;">${day.date}</span>`;
                chip.onclick = () => {
                    container.querySelectorAll('.date-chip').forEach(c => c.classList.remove('active'));
                    chip.classList.add('active');
                    selectDay(index, type);
                };
                container.appendChild(chip);
            };
            createChip(schedContainer, 'schedule');
            createChip(mapContainer, 'map');
        });
    }

    function getTransitMapUrl(destination) { 
        return `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(destination)}&travelmode=transit`; 
    }

    function formatText(text) {
        return text
            .replace(/ã€å·²è¨‚ç¥¨(.*?)ã€‘/g, '<span class="highlight-ticket" onclick="jumpToBookings()"><i class="fa-solid fa-ticket"></i> ã€å·²è¨‚ç¥¨$1ã€‘</span>')
            .replace(/ã€å·²é ç´„(.*?)ã€‘/g, '<span class="highlight-reserve" onclick="jumpToBookings()"><i class="fa-solid fa-bell-concierge"></i> ã€å·²é ç´„$1ã€‘</span>');
    }

    let map = null;
    let markerLayer = null;
    let routeLayer = null;

    function selectDay(index, type) {
        const data = scheduleData[index];
        document.getElementById('main-content').scrollTop = 0; 
        
        if (type === 'schedule') {
            document.getElementById('day-title').innerText = `${data.icon} ${data.title}`;
            const container = document.getElementById('timeline-container');
            container.innerHTML = '';
            
            data.items.forEach(item => {
                let catClass = 'cat-attraction';
                if (/æ­ä¹˜|ç§»å‹•|Skyliner|åœ°éµ|æ­¥è¡Œ|å‰å¾€|è¿”å›|é€€æˆ¿/.test(item.title)) catClass = 'cat-transport';
                if (/åˆé¤|æ™šé¤|æ˜Ÿå·´å…‹|ç‡’è‚‰|æ²¾éºµ|ä»ŠåŠ|ç”œç”œåœˆ|å¸ƒä¸/.test(item.title + item.desc)) catClass = 'cat-food';
                if (/âš ï¸/.test(item.title + item.desc + item.tip)) catClass = 'cat-alert';

                const mainNav = item.nav ? `<a href="${getTransitMapUrl(item.nav)}" target="_blank" class="nav-btn"><i class="fa-solid fa-location-arrow" style="color:#4285F4;"></i> å°èˆª</a>` : '';
                const mainLink = item.link ? `<a href="${item.link}" target="_blank" class="nav-btn external"><i class="fa-solid fa-link"></i> æŒ‡å—</a>` : '';
                const tipHtml = item.tip ? `<div class="tip-box"><i class="fa-solid fa-lightbulb"></i><div>${item.tip}</div></div>` : '';
                
                let subSpotsHtml = '';
                if (item.subSpots && item.subSpots.length > 0) {
                    const spotsList = item.subSpots.map(spot => {
                        const spotNav = spot.nav ? `<a href="${getTransitMapUrl(spot.nav)}" target="_blank" class="nav-btn"><i class="fa-solid fa-location-dot"></i></a>` : '';
                        const spotLink = spot.link ? `<a href="${spot.link}" target="_blank" class="nav-btn external"><i class="fa-solid fa-link"></i></a>` : '';
                        const spotPhoto = spot.photo ? `<a href="${spot.photo}" target="_blank" class="nav-btn photo"><i class="fa-solid fa-camera"></i> èœå–®</a>` : '';
                        return `
                        <div class="sub-spot-item">
                            <div class="sub-spot-title"><i class="fa-solid fa-caret-right" style="color:var(--accent-color);"></i> ${spot.name}</div>
                            <div style="color:var(--text-sub); line-height:1.4; margin-bottom:8px;">${spot.desc}</div>
                            <div>${spotNav}${spotPhoto}${spotLink}</div>
                        </div>`;
                    }).join('');

                    // å‹•æ…‹åˆ‡æ›æ‘ºç–ŠæŒ‰éˆ•æ¨™é¡Œ
                    let accTitle = `<i class="fa-solid fa-list-ul"></i> å±•é–‹è©³ç´°æ™¯é» (${item.subSpots.length})`;
                    if (catClass === 'cat-food') {
                        accTitle = `<i class="fa-solid fa-utensils"></i> æŸ¥çœ‹é¤å»³ä»‹ç´¹èˆ‡å¿…é» (${item.subSpots.length})`;
                    } else if (/é€›è¡—|æ¡è²·|å•†å ´|æ•£ç­–/.test(item.title)) {
                        accTitle = `<i class="fa-solid fa-store"></i> æŸ¥çœ‹æ¨è–¦åº—å®¶èˆ‡äº®é» (${item.subSpots.length})`;
                    }

                    subSpotsHtml = `<details class="sub-spots"><summary>${accTitle}</summary>${spotsList}</details>`;
                }
                
                container.innerHTML += `
                    <div class="timeline-item ${catClass}">
                        <div class="timeline-dot"></div>
                        <div class="timeline-card glass">
                            <div class="time-text">${item.time}</div>
                            <div class="title-text">${formatText(item.title)}</div>
                            <div class="desc-text" style="margin-bottom:5px;">${formatText(item.desc)}</div>
                            ${mainNav}${mainLink}
                            ${tipHtml}
                            ${subSpotsHtml}
                        </div>
                    </div>
                `;
            });

            container.innerHTML += `<div class="back-to-top-btn" onclick="scrollToTop()"><i class="fa-solid fa-arrow-up"></i> å›åˆ°é ‚éƒ¨</div>`;

        } else if (type === 'map') {
            if (!map) {
                map = L.map('interactive-map', { zoomControl: false }).setView([35.6895, 139.6917], 12);
                L.control.zoom({ position: 'bottomright' }).addTo(map);
                L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);
                markerLayer = L.layerGroup().addTo(map);
                routeLayer = L.layerGroup().addTo(map);
            }
            markerLayer.clearLayers(); 
            routeLayer.clearLayers();
            const latlngs =[];
            
            const getColor = (t) => { 
                if(t === 'transport') return 'var(--tag-transport)'; 
                if(t === 'attraction') return 'var(--tag-attraction)'; 
                return 'var(--tag-food)'; 
            };

            data.mapData.forEach((spot, i) => {
                latlngs.push([spot.lat, spot.lng]);
                const customIcon = L.divIcon({
                    className: 'custom-div-icon',
                    html: `<div style="background-color:${getColor(spot.type)}; width:24px; height:24px; border-radius:50%; border:3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3); display:flex; justify-content:center; align-items:center; color:white; font-size:12px; font-weight:bold;">${i+1}</div>`,
                    iconSize: [24, 24], iconAnchor: [12, 12]
                });
                L.marker([spot.lat, spot.lng], {icon: customIcon})
                 .bindPopup(`<b>${i+1}. ${spot.name}</b><br><a href="${getTransitMapUrl(spot.name)}" target="_blank" style="color:#4285F4; text-decoration:none; font-weight:bold; margin-top:5px; display:block;">ğŸ“ Google å°èˆª</a>`)
                 .addTo(markerLayer);
            });

            if (latlngs.length > 1) {
                L.polyline(latlngs, { color: '#4285F4', weight: 4, opacity: 0.7, dashArray: '8, 8' }).addTo(routeLayer);
                map.fitBounds(L.polyline(latlngs).getBounds(), { padding:[40, 40] });
            } else if (latlngs.length === 1) { 
                map.setView(latlngs[0], 14); 
            }
        }
    }

    // --- å…±ç”¨æ»‘å‹•é‚è¼¯ (Swipe to Delete / Edit) ---
    let startX = 0; let currentX = 0;
    
    window.ts = function(e) { 
        startX = e.touches[0].clientX; 
        currentX = 0; 
    };
    
    window.tm = function(e, id) {
        let diff = e.touches[0].clientX - startX;
        let track = document.getElementById(`track-${id}`);
        if (diff < 0) {
            let move = diff;
            if (move < -140) { move = -140 + (move + 140) * 0.2; }
            track.style.transition = 'none';
            track.style.transform = `translateX(${move}px)`;
            currentX = diff;
        }
    };
    
    window.te = function(e, id) {
        let track = document.getElementById(`track-${id}`);
        track.style.transition = 'transform 0.25s cubic-bezier(0.2, 0.8, 0.2, 1)';
        if (currentX < -40) { 
            track.style.transform = `translateX(-140px)`; 
        } else { 
            track.style.transform = `translateX(0)`; 
        }
    };

    // --- 3. è¨˜å¸³é‚è¼¯ ---
    function saveExpense() {
        const idInput = document.getElementById('edit-id');
        const dateInput = document.getElementById('exp-date').value;
        const catSelect = document.getElementById('exp-category');
        const amtInput = document.getElementById('exp-amount');
        const amount = parseInt(amtInput.value);
        const categoryText = catSelect.options[catSelect.selectedIndex].text;
        const editId = idInput.value;

        if (!dateInput || !amount || amount <= 0) { alert('è«‹å¡«å¯«æœ‰æ•ˆé‡‘é¡ï¼'); return; }

        if (editId) {
            const exp = expenses.find(e => e.id === editId);
            if(exp) { exp.date = dateInput; exp.category = categoryText; exp.amount = amount; }
            document.getElementById('btn-save-exp').innerHTML = `<i class="fa-solid fa-check"></i> ç¢ºèªæ–°å¢`;
            document.getElementById('btn-save-exp').style.background = 'var(--accent-color)';
            idInput.value = '';
        } else { 
            expenses.push({ id: `e-${Date.now()}`, date: dateInput, category: categoryText, amount: amount }); 
        }
        
        saveData(); 
        amtInput.value = ''; 
        renderExpenses();
    }

    function editExpense(id) {
        const exp = expenses.find(e => e.id === id);
        if (!exp) return;
        
        document.getElementById('exp-date').value = exp.date;
        document.getElementById('exp-amount').value = exp.amount;
        document.getElementById('edit-id').value = exp.id;
        const catSelect = document.getElementById('exp-category');
        for (let i = 0; i < catSelect.options.length; i++) { 
            if (catSelect.options[i].text === exp.category) { catSelect.selectedIndex = i; break; } 
        }
        
        const btn = document.getElementById('btn-save-exp');
        btn.innerHTML = `<i class="fa-solid fa-pen"></i> æ›´æ–°å„²å­˜`;
        btn.style.background = '#FFB067';
        document.getElementById('main-content').scrollTo({ top: 0, behavior: 'smooth' });
        document.getElementById(`track-${id}`).style.transform = `translateX(0)`;
    }

    function deleteExpense(id) {
        document.getElementById(`track-${id}`).style.transform = `translateX(0)`;
        setTimeout(() => { 
            expenses = expenses.filter(e => e.id !== id); 
            saveData(); 
            renderExpenses(); 
        }, 200);
    }

    function renderExpenses() {
        const container = document.getElementById('expense-list-container');
        container.innerHTML = '';
        
        const grouped = expenses.reduce((acc, exp) => {
            if(!acc[exp.date]) acc[exp.date] = { total: 0, items: [] };
            acc[exp.date].total += exp.amount; 
            acc[exp.date].items.push(exp); 
            return acc;
        }, {});

        const sortedDates = Object.keys(grouped).sort((a,b) => new Date(b) - new Date(a));
        let grandTotalJpy = 0;

        sortedDates.forEach(date => {
            grandTotalJpy += grouped[date].total;
            let itemsHtml = grouped[date].items.map(exp => `
                <div class="swipe-wrapper">
                    <div class="swipe-track" id="track-${exp.id}" ontouchstart="ts(event)" ontouchmove="tm(event, '${exp.id}')" ontouchend="te(event, '${exp.id}')">
                        <div class="swipe-content">
                            <div style="font-weight:700; color:var(--text-main); font-size:15px;">${exp.category}</div>
                            <div style="color:var(--accent-color); font-weight:700; font-size:16px;">Â¥ ${exp.amount.toLocaleString()}</div>
                        </div>
                        <div class="swipe-actions">
                            <button class="swipe-btn edit" onclick="editExpense('${exp.id}')"><i class="fa-solid fa-pen"></i></button>
                            <button class="swipe-btn delete" onclick="deleteExpense('${exp.id}')"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                </div>
            `).join('');

            container.innerHTML += `
                <div class="daily-expense-group">
                    <div class="daily-expense-title">
                        <span>ğŸ“… ${date}</span><span style="color:var(--accent-color);">å°è¨ˆ: Â¥ ${grouped[date].total.toLocaleString()}</span>
                    </div>
                    ${itemsHtml}
                </div>
            `;
        });

        const totalTwd = Math.round(grandTotalJpy * exchangeRate);
        document.getElementById('total-jpy').innerText = `Â¥ ${grandTotalJpy.toLocaleString()} (åŒ¯ç‡ ${exchangeRate})`;
        document.getElementById('total-twd').innerText = `NT$ ${totalTwd.toLocaleString()}`;
    }

    // --- 5. æº–å‚™æ¸…å–®é‚è¼¯ (å‹•æ…‹æ–°å¢èˆ‡ç·¨è¼¯) ---
    function togglePlan(catIdx, itemIdx) { 
        plans[catIdx].items[itemIdx].done = !plans[catIdx].items[itemIdx].done; 
        saveData(); 
        renderPlans(); 
    }

    function addPlan(catIdx) {
        const input = document.getElementById(`add-plan-input-${catIdx}`);
        const text = input.value.trim();
        if(text) { 
            plans[catIdx].items.push({ id: `p-${Date.now()}`, text: text, done: false }); 
            saveData(); 
            renderPlans(); 
        }
    }

    function editPlan(catIdx, itemIdx, id) {
        document.getElementById(`track-${id}`).style.transform = `translateX(0)`;
        setTimeout(() => {
            const newText = prompt("ä¿®æ”¹æº–å‚™é …ç›®ï¼š", plans[catIdx].items[itemIdx].text);
            if(newText && newText.trim() !== "") { 
                plans[catIdx].items[itemIdx].text = newText.trim(); 
                saveData(); 
                renderPlans(); 
            }
        }, 100);
    }

    function deletePlan(catIdx, itemIdx, id) {
        document.getElementById(`track-${id}`).style.transform = `translateX(0)`;
        setTimeout(() => { 
            plans[catIdx].items.splice(itemIdx, 1); 
            saveData(); 
            renderPlans(); 
        }, 200);
    }

    function renderPlans() {
        const container = document.getElementById('planning-list-container');
        container.innerHTML = '';
        
        plans.forEach((group, catIdx) => {
            let itemsHtml = group.items.map((item, itemIdx) => `
                <div class="swipe-wrapper" style="background: rgba(255,255,255,0.4); margin-bottom: 5px;">
                    <div class="swipe-track" id="track-${item.id}" ontouchstart="ts(event)" ontouchmove="tm(event, '${item.id}')" ontouchend="te(event, '${item.id}')">
                        <div class="swipe-content" style="padding: 12px; cursor:pointer;" onclick="togglePlan(${catIdx}, ${itemIdx})">
                            <div class="check-item ${item.done ? 'plan-item-done' : ''}" style="margin:0; padding:0; display:flex; align-items:center;">
                                <div class="plan-box"></div>
                                <span class="plan-text" style="font-weight:700;">${item.text}</span>
                            </div>
                        </div>
                        <div class="swipe-actions">
                            <button class="swipe-btn edit" onclick="editPlan(${catIdx}, ${itemIdx}, '${item.id}')"><i class="fa-solid fa-pen"></i></button>
                            <button class="swipe-btn delete" onclick="deletePlan(${catIdx}, ${itemIdx}, '${item.id}')"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML += `
                <div class="plan-group">
                    <div class="plan-group-title">${group.cat}</div>
                    ${itemsHtml}
                    <div class="add-plan-row">
                        <input type="text" id="add-plan-input-${catIdx}" class="add-plan-input" placeholder="æ–°å¢é …ç›®...">
                        <button class="add-plan-btn" onclick="addPlan(${catIdx})"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </div>
            `;
        });
    }
</script>

</body>
</html>
